!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("photoeditorsdk/PhotoEditorSDK.UI.DesktopUI.Core"),require("photoeditorsdk")):"function"==typeof define&&define.amd?define([["PhotoEditorSDK","UI","DesktopUI"],"photoeditorsdk"],e):"object"==typeof exports?exports._unexposedPESDK=e(require("photoeditorsdk/PhotoEditorSDK.UI.DesktopUI.Core"),require("photoeditorsdk")):t._unexposedPESDK=e(t.PhotoEditorSDK.UI.DesktopUI,t.PhotoEditorSDK)}("undefined"!=typeof self?self:this,function(t,e){return function(t){function e(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=38)}({0:function(e,o){e.exports=t},1:function(t,o){t.exports=e},3:function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=o(1),p=(o.n(a),o(0)),c=(o.n(p),Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t}),l=a.Math.Vector2,u=void 0;a.Operations.SpriteOperation&&(u=a.Operations.SpriteOperation.TextSprite);var h=function(t){function e(){r(this,e);for(var o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];var a=i(this,t.call.apply(t,[this].concat(n)));return a._bindAll("_onDragStart","_onDrag","_onDragStop","_onRotateDragStart","_onRotateDrag","_onRotateDragStop","_onCornerDrag","_onCornerDragStop","_onSpriteUpdate","_onTakeToFront","_onFlipHorizontally","_onDuplicate","_onDelete"),a}return s(e,t),e.prototype.componentDidMount=function(){this.props.sprite.on("update",this._onSpriteUpdate)},e.prototype.componentWillUnmount=function(){this.props.sprite.off("update",this._onSpriteUpdate)},e.prototype.componentWillReceiveProps=function(t){this.props.sprite.off("update",this._onSpriteUpdate),t.sprite.on("update",this._onSpriteUpdate)},e.prototype._onSpriteUpdate=function(){this.forceUpdate()},e.prototype._onTakeToFront=function(t){t.stopPropagation(),this.props.onTakeToFront&&this.props.onTakeToFront(t)},e.prototype._onFlipHorizontally=function(t){t.stopPropagation(),this.props.onFlipHorizontally&&this.props.onFlipHorizontally(t)},e.prototype._onDelete=function(t){t.stopPropagation(),this.props.onDelete&&this.props.onDelete(t)},e.prototype._onDuplicate=function(t){t.stopPropagation(),this.props.onDuplicate&&this.props.onDuplicate(t)},e.prototype._onBeforeScale=function(){},e.prototype._onScale=function(t){},e.prototype._onRotateDragStart=function(){this._imageBoundingBox=this.props.canvasControls.getImageBoundingRect(),this._containerOffset=this.props.canvasControls.getContainerOffset(),this.props.onBeforeChange&&this.props.onBeforeChange(),this.props.onCanvasClickDisabled&&this.props.onCanvasClickDisabled()},e.prototype._onRotateDrag=function(t,e){var o=this.context.editor,n=this.props.sprite,r=this._getAbsoluteSpritePosition().add(this._imageBoundingBox.x,this._imageBoundingBox.y),i=r.clone(),s=e.clone().subtract(this._containerOffset).subtract(i),a=Math.atan2(s.y,s.x)-Math.PI/2,p=this.props,c=p.snapRotation,l=p.snapRotationTolerance,u=Math.round(180*a/Math.PI),h=Math.round(u/c)*c,d=u-h;Math.abs(d)<l&&(a=h*Math.PI/180),n.setRotation(a),o.render(),this.forceUpdate()},e.prototype._onRotateDragStop=function(){this.props.onAfterChange&&this.props.onAfterChange(),this.props.onCanvasClickEnabled&&this.props.onCanvasClickEnabled()},e.prototype._onCornerDragStart=function(t,e,o,n){var r=this.context.editor,i=this.props.sprite,s=i.getDimensions(r.getSDK(),r.getOutputDimensions()),a=s.x;this._imageBoundingBox=this.props.canvasControls.getImageBoundingRect(),this._containerOffset=this.props.canvasControls.getContainerOffset();var p=i.getPivot(),c=i.getAnchor(),u=this._getAbsoluteSpritePosition().add(this._imageBoundingBox.x,this._imageBoundingBox.y),h=i.getDimensions(r.getSDK(),r.getOutputDimensions()),d=new l(h.width,h.height),f=u.clone().subtract(d.clone().multiply(c)).add(d.clone().multiply(p)).round(),g=n.clone().subtract(this._containerOffset).subtract(f);this._initialScaleSettings={width:a,mouseDistanceFromPivot:g},this._onBeforeScale(),this.props.onBeforeChange&&this.props.onBeforeChange(),this.props.onCanvasClickDisabled&&this.props.onCanvasClickDisabled()},e.prototype._onCornerDrag=function(t){var e=this.context.editor,o=this.props.sprite,n=o.getRotation(),r=this._initialScaleSettings,i=r.width,s=r.mouseDistanceFromPivot,a=s.clone().add(t),p=Math.cos(n),c=Math.sin(n),l=Math.max(Math.abs(2*(a.x*p+a.y*c)),this.constructor.MIN_WIDTH),u=l/i;e.render(),this._onScale(u)},e.prototype._onCornerDragStop=function(){this.props.onAfterChange&&this.props.onAfterChange(),this.props.onCanvasClickEnabled&&this.props.onCanvasClickEnabled()},e.prototype._isDraggingDisabled=function(){return!this.props.selected},e.prototype._onDragStart=function(){var t=this.props.sprite;this._initialPosition=t.getPosition(),this.props.onBeforeChange&&this.props.onBeforeChange()},e.prototype._onDrag=function(t){var e=this.props.sprite,o=this.context.editor,n=o.getOutputDimensions(),r=this._initialPosition.clone().add(t.divide(n));e.setPosition(r),o.render(),this.forceUpdate()},e.prototype._onDragStop=function(){this.props.onAfterChange&&this.props.onAfterChange()},e.prototype._getAbsoluteSpritePosition=function(){var t=this.context.editor,e=t.getOutputDimensions();return this.props.sprite.getPosition().clone().multiply(e)},e.prototype._getContainerStyle=function(){return{}},e.prototype._renderKnobs=function(){var t=this,e=[];return["top","bottom"].forEach(function(o){["left","right"].forEach(function(r){var i=o+"-"+r,s=n({},i,!0);e.push(p.React.createElement(p.DraggableComponent,{key:i,onStart:t._onCornerDragStart.bind(t,o,r),onDrag:t._onCornerDrag,onStop:t._onCornerDragStop},p.React.createElement(S,s)))})}),e},e.prototype._getSpriteDimensions=function(){var t=this.context.editor,e=this.props.sprite,o=t.getOutputDimensions();return e.getDimensions(t.getSDK(),o)},e.prototype._getOverlayPosition=function(){var t=this.context.editor,e=this.props.sprite,o=t.getOutputDimensions(),n=this._getSpriteDimensions(),r=e.getPosition().clone().multiply(o),i=e.getRotation(),s=Math.sin(i),a=Math.cos(i),p=new l(Math.abs(n.x*a)+Math.abs(n.y*s),Math.abs(n.x*s)+Math.abs(n.y*a));return new l(r.x,r.y-p.y/2-70).clamp(new l(80,20),o.clone().subtract(80,70))},e.prototype._renderOverlayControls=function(){if(this.props.selected)return p.React.createElement(p.CanvasOverlayControlsComponent,{takeToFront:!0,flipHorizontally:!(this.props.sprite instanceof u),duplicate:!0,delete:!0,position:this._getOverlayPosition(),onTakeToFront:this._onTakeToFront,onFlipHorizontally:this._onFlipHorizontally,onDuplicate:this._onDuplicate,onDelete:this._onDelete})},e.prototype._getItemControlsProps=function(){return{}},e.prototype.render=function(){var t=this,e=this.props,o=e.selected,n=e.sprite,r=this.state.editing,i=!r,s=[this._renderKnobs(),p.React.createElement(_,{key:"rotateControls"},p.React.createElement(p.DraggableComponent,{onStart:this._onRotateDragStart,onDrag:this._onRotateDrag,onStop:this._onRotateDragStop},p.React.createElement(v,null)))],a=this._getItemControlsProps(),l=p.React.createElement(g,c({style:this._getContainerStyle()},a),s);return p.React.createElement(p.DraggableComponent,{onStart:this._onDragStart,onStop:this._onDragStop,onDrag:this._onDrag,disabled:this._isDraggingDisabled()},p.React.createElement(d,{onClick:this.props.onClick,"data-type":n.constructor.type,"data-selected":o,className:void 0},this._renderOverlayControls(),p.React.createElement(f,{style:this._getContainerStyle(),editing:o&&r,innerRef:function(e){t._container=e},className:void 0},p.React.createElement(y,null,this._renderContent()),o&&!i&&s),o&&i&&l))},e}(p.BaseComponent);h.contextTypes=p.BaseComponent.contextTypes,h.MIN_WIDTH=1,h.defaultProps={snapRotation:90,snapRotationTolerance:5},e.a=h;var d=p.adonis.div("120drhm","OuterContainer"),f=p.adonis.div("bkf7u8",{editing:"64zghi"},"Container"),g=p.adonis.div("36haff","ItemControls"),y=p.adonis.div("120drhm","Content"),_=p.adonis.div("77tiy3","RotateControl"),m=p.adonis.div("mznefm","Knob"),v=Object(p.adonis)(m)("1en5760","RotateKnob"),S=Object(p.adonis)(m)("bdmepn",{"top-left":"1dtvxe8","top-right":"1tu191k","bottom-left":"1we5ut6","bottom-right":"f2wva1"},"CornerKnob")},38:function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=o(1),a=(o.n(s),o(0)),p=o.n(a),c=o(39),l=o(41),u=function(t){function e(){return n(this,e),r(this,t.apply(this,arguments))}return i(e,t),e.prototype._onEnter=function(){var t=this,e=this.context.editor,o=e.operations.getOrCreate("sprite"),n=o.createBrush();o.addSprite(n),e.zoom.auto(!1,!1,function(){e.features.disable("zoom","drag");var o=e.getOutputDimensions(),n=Math.max(.05*o.min(),1);t._options.widthPresets&&t._options.widthPresets.length>0&&(n=t._options.sizePresets[0]),t.sharedState.set({brushSize:Math.round(n)})}),this.sharedState.set({operation:o,brushSprite:n,brushColor:s.Color.WHITE,brushSize:.1,brushHardness:50})},e.prototype._onLeave=function(){var t=this.context.editor;t.features.enable("zoom","drag"),t.render()},e.prototype._onOperationRemoved=function(t){if(t===this.sharedState.get("operation")){var e=this.context.editor.operations.getOrCreate("sprite"),o=e.createBrush();e.addSprite(o),this.sharedState.set({operation:e,brushSprite:o})}},e.isEnabled=function(t){return t.isToolAllowed("brush")&&t.isToolEnabled("brush")},e}(a.BaseControls);u.clickAtPosition=a.BaseControls.clickAtPosition,u.getPreloadAssets=a.BaseControls.getPreloadAssets,u.identifier="brush",u.controlsComponent=c.a,u.canvasControlsComponent=l.a,u.iconPath="editor/controls/brush/icon.png",u.activeIconPath="editor/controls/brush/icon-active.png",u.requiredOperations=["sprite"],u.defaultOptions={brushes:[],replaceBrushes:!1,availableBrushes:null},e.default=u,p.a.Controls.BrushControls=u},39:function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=o(1),p=(o.n(a),o(0)),c=(o.n(p),o(40)),l=a.Operations.SpriteOperation,u=void 0;l&&(u=a.Operations.SpriteOperation.BrushSprite.Brush);var h=p.GroupedControlsStyles.ControlGroupTitle,d=p.GroupedControlsStyles.ControlGroup,f=function(t){function e(){r(this,e);for(var o=arguments.length,s=Array(o),a=0;a<o;a++)s[a]=arguments[a];var c=i(this,t.call.apply(t,[this].concat(s)));return c._bindAll("_onBrushColorChanged","_onBrushHardnessChanged","_onBrushWidthChanged","_onOperationUpdated"),c._events=n({},p.Constants.EVENTS.OPERATION_UPDATED,c._onOperationUpdated),c._initBrushManager(),c}return s(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this._onBrushSelect(this._brushManager.getBrushes()[0])},e.prototype._initBrushManager=function(){this._brushManager=new p.BrushManager(this.context.ui,this.props.options)},e.prototype._onBrushColorChanged=function(t){var e=this.getSharedState("brushInstance").clone();e.setColor(t.clone()),this.setSharedState({brushInstance:e})},e.prototype._onBrushHardnessChanged=function(t){var e=this.getSharedState("brushInstance").clone();e.setHardness(t/100),this.setSharedState({brushInstance:e,brushHardness:Math.round(t)})},e.prototype.sharedStateDidChange=function(t,e){t.brushSize!==e.brushSize&&this._onBrushWidthChanged(e.brushSize)},e.prototype._onBrushWidthChanged=function(t){var e=this.context.editor,o=e.getOutputDimensions(),n=this.getSharedState("brushInstance").clone();n.setSize(t/o.min()),this.setSharedState({brushInstance:n,brushSize:Math.round(t)})},e.prototype._onOperationUpdated=function(t){var e=this.context.editor;if(t===this.getSharedState("operation")){var o=this.getSharedState("brushSprite");if(o){var n=t.getSprites().filter(function(t){return t.getId()===o.getId()})[0];this.setSharedState({brushSprite:n})}e.render()}},e.prototype._onBrushSelect=function(t){var e=this,o=this.context.editor,n=o.getOutputDimensions(),p=this.getSharedState("brushSize")/n.min(),c=this.getSharedState("brushHardness")/100,l=this.getSharedState("brushColor"),h={size:p,color:l},d=void 0;if(t.prototype&&t.prototype instanceof u){d=new t(h)}else{var f=a.Utils.extend({},t);delete f.image;var g=function(t){function e(){return r(this,e),i(this,t.apply(this,arguments))}return s(e,t),e}(u);g.identifier=t.identifier,d=new g(a.Utils.extend({},f,h))}d.hasOption("hardness")&&d.setHardness(c),this._loadBrush(t,d).then(function(){e.setSharedState({brushInstance:d,brush:t})})},e.prototype._loadBrush=function(t,e){var o=this;return new Promise(function(n,r){if(t.constructor===Object){var i=new window.Image;i.addEventListener("load",function(){e.setImage(i),n()}),i.addEventListener("error",function(){r(new Error("Failed to load image at "+i.src))}),i.src=o._getAssetPath(t.image),i.crossOrigin="Anonymous"}else n()})},e.prototype._getRootProps=function(){return{className:void 0,withBorderTop:!0}},e.prototype._renderBrushItems=function(){var t=this,e=this._brushManager.getBrushes();return e.length<=1?null:e.map(function(e){return p.React.createElement(c.a,{key:e.identifier,brush:e,selected:t.getSharedState("brush")===e,onClick:t._onBrushSelect.bind(t,e)})})},e.prototype._renderContent=function(){var t=this,e=this.getSharedState("brushInstance");return p.React.createElement(p.ScrollableListComponent,{direction:"vertical",innerListRef:function(e){t._list=e},innerRef:function(e){t._scrollbar=e}},p.React.createElement(y,null,p.React.createElement(_,null,this._t("editor.controls.brush.settings")),p.React.createElement(m,null,p.React.createElement(p.ColorSelectionComponent,{value:this.getSharedState("brushColor"),onChange:this._onBrushColorChanged})),p.React.createElement(g,{label:this._t("editor.controls.brush.width"),minValue:1,maxValue:100,value:this.getSharedState("brushSize"),onSliderValueChange:this._onBrushWidthChanged,onValueChange:this._onBrushWidthChanged,className:void 0}),p.React.createElement(g,{label:this._t("editor.controls.brush.hardness"),minValue:0,maxValue:100,disabled:!(e&&e.hasOption("hardness")),value:this.getSharedState("brushHardness"),onSliderValueChange:this._onBrushHardnessChanged,onValueChange:this._onBrushHardnessChanged})),p.React.createElement(v,null,p.React.createElement(p.ScrollbarComponent,{direction:"vertical"},p.React.createElement(S,null,this._renderBrushItems()))))},e}(p.ControlsComponent);f.contextTypes=p.ControlsComponent.contextTypes,f.RootElement=p.ControlsComponent.RootElement,e.a=f;var g=Object(p.adonis)(p.SliderControlComponent)("6vpx1b","SliderControl"),y=Object(p.adonis)(d).div("r92vc7","Settings"),_=Object(p.adonis)(h).div("120drhm","SettingsTitle"),m=p.adonis.div("yzsuxp","ColorSelection"),v=p.adonis.div("16dil83","Brushes"),S=p.adonis.ul("1lb1mg4","BrushList")},40:function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=o(1),a=(o.n(s),o(0)),p=(o.n(a),a.ControlsStyles.PlainControlItemBackground),c=s.Operations.SpriteOperation,l=void 0,u=void 0;c&&(l=c.BrushSprite.Brush,u=c.BrushSprite.Path);var h=s.Math.Vector2,d=function(t){function e(){return n(this,e),r(this,t.apply(this,arguments))}return i(e,t),e.prototype._loadBrush=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.brush;return new Promise(function(o,n){if(e.constructor===Object){var r=new window.Image;r.addEventListener("load",function(){t._brush.setImage(r),o()}),r.addEventListener("error",function(){n(new Error("Failed to load image at "+r.src))}),r.src=t._getAssetPath(e.image),r.crossOrigin="Anonymous"}else o()})},e.prototype._drawBrush=function(){var t=new u(null,{brush:this._brush},this._canvas);t.addControlPoint(new h(.1,.5)),t.addControlPoint(new h(.9,.5)),t.render(new h(this._canvas.width,this._canvas.height))},e.prototype._instantiateBrush=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.brush,e={color:s.Color.WHITE,size:.25};if(t.prototype&&t.prototype instanceof l){var o=t;this._brush=new o(e)}else{var a=s.Utils.extend({},t);delete a.image;var p=function(t){function e(){return n(this,e),r(this,t.apply(this,arguments))}return i(e,t),e}(l);p.identifier=t.identifier,this._brush=new p(s.Utils.extend({},a,e))}},e.prototype.componentDidMount=function(){var e=this;t.prototype.componentDidMount.call(this),this._instantiateBrush();var o=this._canvas,n=o.offsetWidth,r=o.offsetHeight;this._canvas.width=n,this._canvas.height=r,this._loadBrush().then(function(t){e._drawBrush()})},e.prototype.render=function(){var t=this;return a.React.createElement(f,{onClick:this.props.onClick,selected:this.props.selected,className:void 0,"data-selected":this.props.selected},a.React.createElement(g,{innerRef:function(e){t._canvas=e}}))},e}(a.BaseComponent);e.a=d;var f=Object(a.adonis)(p).li("8908c2",{selected:"120drhm"},"BrushListItem"),g=a.adonis.canvas("1ssoezr","Canvas")},41:function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=o(1),a=(o.n(s),o(0)),p=(o.n(a),o(6)),c=s.Operations.SpriteOperation?s.Operations.SpriteOperation:{},l=c.BrushSprite,u=s.Math.Vector2,h=function(t){function e(){n(this,e);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];var p=r(this,t.call.apply(t,[this].concat(i)));return p._bindAll("_onMouseEnter","_onMouseLeave","_onMouseMove","_onDrawStart","_onDraw","_onDrawStop"),p.state=s.Utils.extend(p.state,{cursorPosition:new u(0,0),canvasClickDisabled:!0}),p}return i(e,t),e.prototype._onDrawStart=function(t){var e=this.context.editor,o=e.getOutputDimensions();this._initialDrawPosition=t.clone();var n=this.getSharedState("brushSprite"),r=this.getSharedState("brushInstance"),i=this.getSharedState("operation");n||(n=i.createBrush(),i.addSprite(n),this.setSharedState({brushSprite:n})),this._currentPath=n.createPath(r),this._currentPath.addControlPoint(t.clone().divide(o)),this._lastDrawPosition=this._initialDrawPosition.clone(),this._lastCursorPosition=this._initialDrawPosition.clone()},e.prototype._onDraw=function(t,e,o){var n=this.context.editor,r=n.getOutputDimensions(),i=n.getOutputTextureDimensions(),s=this._lastCursorPosition.clone().add(o),a=n.zoom.level,p=this.getSharedState("brushSize");s.clone().subtract(this._lastDrawPosition).abs().len()/a>=p/10&&(this._currentPath.addControlPoint(s.clone().divide(r)),this.getSharedState("brushSprite").render(i),this._lastDrawPosition.copy(s)),this._lastCursorPosition.copy(s)},e.prototype._onDrawStop=function(){this._currentPath.setClosed(!0);var t=this.context.editor,e=t.getOutputTextureDimensions();this.getSharedState("brushSprite").render(e),this.props.controls.addLocalHistorySnapshot(),this._currentPath=null},e.prototype._onMouseEnter=function(){this.setState({cursorVisible:!0})},e.prototype._onMouseLeave=function(){this.setState({cursorVisible:!1})},e.prototype._onMouseMove=function(t){var e=a.Utils.getEventPosition(t),o=this._innerContainer.getBoundingClientRect();e.subtract(o.left,o.top),this.setState({cursorPosition:e})},e.prototype._getPropsForSprite=function(e){var o=t.prototype._getPropsForSprite.call(this,e);return e instanceof l&&(o.hideContent=!1),o},e.prototype._getCursorStyle=function(){return{width:this.getSharedState("brushSize")+8,height:this.getSharedState("brushSize")+8,left:this.state.cursorPosition.x,top:this.state.cursorPosition.y,marginLeft:-.5*(this.getSharedState("brushSize")+8),marginTop:-.5*(this.getSharedState("brushSize")+8)}},e.prototype._renderOverlayControls=function(){return a.React.createElement(a.DraggableComponent,{onStart:this._onDrawStart,onDrag:this._onDraw,onStop:this._onDrawStop},a.React.createElement(d,{onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onMouseMove:this._onMouseMove,className:void 0},a.React.createElement(f,{style:this._getCursorStyle(),visible:this.state.cursorVisible})))},e}(p.a);h.contextTypes=p.a.contextTypes,e.a=h;var d=a.adonis.div("1sc5z35","BrushCanvasControls"),f=a.adonis.div("y4v90o",{visible:"2jlos"},"Cursor")},5:function(t,e,o){"use strict";var n=function(){function t(t,e){var o=[],n=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);n=!0);}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.a={load:function(t){var e=this;return function(){if(t.substr(0,5),!0)return Promise.resolve([t,t])}().then(function(t){var o=n(t,2),r=o[0],i=o[1];return e._createAndLoadImage(r,i)})},_createAndLoadImage:function(t,e){return new Promise(function(t,o){var n=new window.Image;n.addEventListener("load",function(){t(n)}),n.addEventListener("error",function(){o(new Error("Failed to load image at "+e))}),n.crossOrigin="Anonymous",n.src=e})},loadXHR:function(t,e){return new Promise(function(o,n){var r=void 0;window.XDomainRequest?(r=new window.XDomainRequest,e&&r.overrideMimeType(e),r.onload=function(){o(r)},r.onerror=function(t){n(t)}):window.XMLHttpRequest&&(r=new window.XMLHttpRequest,e&&r.overrideMimeType(e),r.onreadystatechange=function(t){4===r.readyState&&(200===r.status?o(r):n(new Error("HTTP Status "+r.status)))}),r.open("GET",t,!0),r.send()})}}},6:function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=o(1),p=(o.n(a),o(0)),c=(o.n(p),o(7)),l=o(8),u=o(9),h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},d=a.Math.Vector2,f=function(t){function e(){var o;r(this,e);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];var u=i(this,t.call.apply(t,[this].concat(c)));return u._bindAll("_onZoomDone","_onWindowResize","_onHistoryChange","_onAfterTransform"),u._events=(o={},n(o,p.Constants.EVENTS.ZOOM_DONE,u._onZoomDone),n(o,p.Constants.EVENTS.WINDOW_RESIZE,u._onWindowResize),n(o,p.Constants.EVENTS.HISTORY_UNDO,u._onHistoryChange),n(o,p.Constants.EVENTS.HISTORY_REDO,u._onHistoryChange),o),u.state=a.Utils.extend(u.state,{visible:!1,canvasClickDisabled:!1}),u}return s(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this.forceUpdate()},e.prototype._onAfterTransform=function(t){var e="sprite-transform-"+t.getId();this.props.controls.addLocalHistorySnapshot(e,!0)},e.prototype._onHistoryChange=function(){var t=this.getSharedState("operation");if(t){var e=this.getSharedState("selectedSprite");-1===t.getSprites().indexOf(e)&&this._selectNextSprite()}},e.prototype._onWindowResize=function(){var t=this;this.context.editor.once("rendered",function(){t.forceUpdate()})},e.prototype._onZoomDone=function(){this.context.editor.render(),this.setState({visible:!0})},e.prototype._onItemBlur=function(){},e.prototype._onCanvasClick=function(t){if(!this.state.canvasClickDisabled){this._performHitTest(p.Utils.getEventPosition(t))||(this.getSharedState("selectedSprite")&&this._onItemBlur(),this.context.screen.switchToControls("default"))}},e.prototype._onSpriteDelete=function(t){this.getSharedState("operation").removeSprite(t),t.dispose(),this._selectNextSprite(),this.props.controls.addLocalHistorySnapshot("sprite-deletion",!1),this.context.editor.render()},e.prototype._onSpriteTakeToFront=function(t){this.getSharedState("operation").takeSpriteToFront(t),this.props.controls.addLocalHistorySnapshot("sprite-order",!1),this.forceUpdate(),this.context.editor.render()},e.prototype._onSpriteFlipHorizontally=function(t,e){e.stopPropagation(),t.setFlipHorizontally(!t.getFlipHorizontally()),this.props.controls.addLocalHistorySnapshot("sprite-flip-horizontally",!1),this.forceUpdate(),this.context.editor.render()},e.prototype._onSpriteDuplicate=function(t,e){e.stopPropagation();var o=this.getSharedState("operation"),n=t.serializeOptions();delete n.id,delete n.type,t.hasOption("image")&&(n.image=t.getImage());var r=o.getInputDimensions();n.position.add(new d(10,10).divide(r));var i=this._createSprite(n);o.addSprite(i),this.setSharedState({selectedSprite:i}),this.props.controls.addLocalHistorySnapshot("sprite-creation",!1),this.context.editor.render()},e.prototype._selectNextSprite=function(){var t=this.getSharedState("operation"),e=t.getSprites(),o=e[e.length-1];o?this.setSharedState({selectedSprite:o}):(this.props.controls.skipHistory=!0,this.context.screen.switchToControls("default"))},e.prototype._getComponentTypeForSprite=function(t){var e=a.Operations.SpriteOperation;switch(t.constructor){case e.StickerSprite:return c.a;case e.TextSprite:return l.a;case e.BrushSprite:return u.a}},e.prototype._getPropsForSprite=function(t){var e={};return e.hideContent=!0,e},e.prototype._renderSpriteItems=function(t){var e=this,o=this.getSharedState("selectedSprite");return t.map(function(t){var n=e._getComponentTypeForSprite(t),r=e._getPropsForSprite(t),i=o===t;return p.React.createElement(n,h({sprite:t,selected:i,onClick:e._onCanvasClick,onAfterChange:e._onAfterTransform.bind(e,t),onCanvasClickDisabled:e._onCanvasClickDisabled,onCanvasClickEnabled:e._onCanvasClickEnabled,onDelete:e._onSpriteDelete.bind(e,t),onTakeToFront:e._onSpriteTakeToFront.bind(e,t),onFlipHorizontally:e._onSpriteFlipHorizontally.bind(e,t),onDuplicate:e._onSpriteDuplicate.bind(e,t),snapRotation:e.props.options.snapRotation,snapRotationTolerance:e.props.options.snapRotationTolerance,canvasControls:e,key:t.getId()},r))})},e.prototype._renderOverlayControls=function(){return null},e.prototype._renderControls=function(){var t=this;if(this.state.visible){var e=this.getSharedState("operation"),o=e.getSprites(),n=this._container&&this._getContainerStyle();return p.React.createElement(g,{className:void 0},p.React.createElement(y,{innerRef:function(e){t._innerContainer=e},style:n,className:void 0},!this.state.canvasClickDisabled&&p.React.createElement(_,{onClick:this._onCanvasClick}),p.React.createElement("div",null,this._renderSpriteItems(o),this._renderOverlayControls())))}},e}(p.CanvasControlsComponent);f.contextTypes=p.CanvasControlsComponent.contextTypes,e.a=f;var g=p.adonis.div("120drhm","CanvasControls"),y=p.adonis.div("1anj0of","Container"),_=p.adonis.div("o35414","ClickHandlerForInternetExplorer")},7:function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=o(0),a=(o.n(s),o(3)),p=o(5),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},l=function(t){function e(){n(this,e);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];var a=r(this,t.call.apply(t,[this].concat(i)));return a.state={renderAsSVG:!1,svgAttributes:{}},a}return i(e,t),e.prototype.componentDidMount=function(){var e=this;if(t.prototype.componentDidMount.call(this),this.props.hideContent)return null;var o=this.props.sprite;o.getImage().src.match(/\w+\.svg(?=\?|$)/i)&&"none"!==o.getTintMode()&&p.a.loadXHR(o.getImage().src,"image/svg+xml").then(function(t){for(var o=t.responseXML.documentElement.attributes,n={},r=0;r<o.length;r++){var i=o[r],s=i.name,a=i.value;"xmlns:xlink"===s&&(s="xmlnsXlink"),n[s]=a}var p=t.responseText.match(/<svg\b[^>]*>([\s\S]*?)<\/svg>/im)[1];p=p.replace(/\s+?fill=["'].*?["']/gi,""),e.setState({renderAsSVG:!0,svgContent:p,svgAttributes:n})})},e.prototype._onBeforeScale=function(){var t=this.props.sprite;this._initialOptions={dimensions:t.getDimensions().clone()}},e.prototype._onScale=function(t){var e=this.context.editor,o=this._initialOptions.dimensions;this.props.sprite.set({dimensions:o.clone().multiply(t/e.zoom.level)}),this.forceUpdate(),e.render()},e.prototype._getSpriteDimensions=function(){var t=this.context.editor;return this.props.sprite.getDimensions().clone().multiply(t.zoom.level)},e.prototype._getContainerStyle=function(){var t=this.context.editor,e=t.getOutputDimensions(),o=this.props.sprite,n=o.getPosition().clone().multiply(e),r=180*o.getRotation()/Math.PI,i="rotateZ("+r.toFixed(2)+"deg)",s=o.getDimensions().clone().multiply(t.zoom.level);return{width:s.x,height:s.y,left:n.x,top:n.y,marginLeft:-.5*s.x,marginTop:-.5*s.y,transform:i,MozTransform:i,msTransform:i,WebkitTransform:i,transformOrigin:"50% 50%",MozTransformOrigin:"50% 50%",msTransformOrigin:"50% 50%",WebkitTransformOrigin:"50% 50%"}},e.prototype._getContentStyle=function(){var t=this.props.sprite,e="rotateY("+(t.getFlipHorizontally()?180:0)+"deg) rotateX("+(t.getFlipVertically()?180:0)+"deg)",o={opacity:t.getAlpha(),transform:e,MozTransform:e,msTransform:e,WebkitTransform:e};return this.state.renderAsSVG&&(o.fill=t.getTintColor().toRGBA()),o},e.prototype._renderContent=function(){if(this.props.hideContent)return null;var t=this.props.sprite,e=this.state.svgAttributes;return this.state.renderAsSVG?React.createElement(h,c({style:this._getContentStyle(),dangerouslySetInnerHTML:{__html:this.state.svgContent}},e)):React.createElement(u,{src:t.getImage().src,style:this._getContentStyle()})},e}(a.a);l.contextTypes=a.a.contextTypes,l.MIN_WIDTH=a.a.MIN_WIDTH,e.a=l;var u=s.adonis.img("1ssoezr","Image"),h=s.adonis.svg("1ssoezr","SVGImage")},8:function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=o(1),p=(o.n(a),o(0)),c=(o.n(p),o(3)),l=a.Math.Vector2,u=function(t){function e(){r(this,e);for(var o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];var a=i(this,t.call.apply(t,[this].concat(n)));return a._bindAll("_onTextChange","_onBlur","_onItemDoubleClick","_onWidthDrag","_onWidthDragStop"),a.state={editing:!1,updateBecauseIESucks:!1},a}return s(e,t),e.prototype._isDraggingDisabled=function(){return t.prototype._isDraggingDisabled.call(this)||this.state.editing},e.prototype.enterEditMode=function(){var t=this,e=this.context.editor,o=this.props.sprite;o.setVisible(!1),e.render(),this.setState({editing:!0},function(){o._edited||(o.setText(""),t._textField.value="",o._edited=!0,t.forceUpdate()),t._textField.focus(),t._textField.select()})},e.prototype.leaveEditMode=function(){var t=this.context.editor;this.props.sprite.setVisible(!0),t.render(),this.setState({editing:!1})},e.prototype.shouldComponentUpdate=function(){return!0},e.prototype._onTakeToFront=function(){var e;this.leaveEditMode();for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];(e=t.prototype._onTakeToFront).call.apply(e,[this].concat(n))},e.prototype._onFlipHorizontally=function(){var e;this.leaveEditMode();for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];(e=t.prototype._onFlipHorizontally).call.apply(e,[this].concat(n))},e.prototype._onDuplicate=function(){var e;this.leaveEditMode();for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];(e=t.prototype._onDuplicate).call.apply(e,[this].concat(n))},e.prototype._onSpriteUpdate=function(e,o){var n=this;p.Utils.Browser.isIElte(10)&&o.alignment&&e.getAlignment()!==o.alignment&&this.setState({updateBecauseIESucks:!0},function(){Object(p.requestAnimationFrame)(function(){n.setState({updateBecauseIESucks:!1})})}),t.prototype._onSpriteUpdate.call(this)},e.prototype._onWidthDragStart=function(t,e,o){var n=this.context.editor,r=this.props.sprite,i=r.getAnchor();this._imageBoundingBox=this.props.canvasControls.getImageBoundingRect(),this._containerOffset=this.props.canvasControls.getContainerOffset();var s=this._getAbsoluteSpritePosition().add(this._imageBoundingBox.x,this._imageBoundingBox.y),a=r.getDimensions(n.getSDK(),n.getOutputDimensions()),p=new l(a.width,a.height),c=s.clone().subtract(p.clone().multiply(i)).add(p.clone().multiply(.5)).round(),u=o.clone().subtract(this._containerOffset).subtract(c);this._initialScaleSettings={maxWidth:r.getMaxWidth(),mouseDistanceFromCenter:u},this.props.onBeforeChange&&this.props.onBeforeChange(),this.props.onCanvasClickDisabled&&this.props.onCanvasClickDisabled()},e.prototype._onWidthDrag=function(t){var e=this.props.sprite,o=e.getRotation(),n=this._initialScaleSettings.mouseDistanceFromCenter,r=n.clone().add(t),i=Math.cos(o),s=Math.sin(o),a=Math.max(Math.abs(2*(r.x*i+r.y*s)),50)/this._imageBoundingBox.width;e.setMaxWidth(a),this.context.editor.render()},e.prototype._onWidthDragStop=function(){this.props.onAfterChange&&this.props.onAfterChange(),this.props.onCanvasClickEnabled&&this.props.onCanvasClickEnabled()},e.prototype._onBlur=function(){this.leaveEditMode();var t=this.props.sprite;t&&""===t.getText()&&(t.setText(this._t("editor.controls.text.defaultText")),t._edited=!1)},e.prototype._onTextChange=function(t){this.props.sprite.setText(t.target.value),this.forceUpdate()},e.prototype._onItemDoubleClick=function(){this.props.selected&&this.enterEditMode()},e.prototype._onBeforeScale=function(){var t=this.props.sprite;this._initialOptions={maxWidth:t.getMaxWidth(),fontSize:t.getFontSize()}},e.prototype._onScale=function(t){var e=this._initialOptions,o=e.maxWidth,n=e.fontSize,r=this.props.sprite;r.set({maxWidth:o*t,fontSize:n*t}),this.context.mediator.emit(p.Constants.EVENTS.TEXT_SCALED,r),this.forceUpdate()},e.prototype._getContainerStyle=function(){var t=this.context.editor,e=t.getOutputDimensions(),o=this.props.sprite,n=o.getPosition().clone().multiply(e),r=180*o.getRotation()/Math.PI,i="rotateZ("+r.toFixed(2)+"deg)",s=o.getMaxWidth()*e.x,a=o.getDimensions(t.getSDK(),e).y;return{width:s,height:a,left:n.x,top:n.y,marginLeft:-.5*s,marginTop:-.5*a,transform:i,MozTransform:i,msTransform:i,WebkitTransform:i,transformOrigin:"50% 50%",MozTransformOrigin:"50% 50%",msTransformOrigin:"50% 50%",WebkitTransformOrigin:"50% 50%"}},e.prototype._getTextStyle=function(){var t=this.context.editor,e=this.props.sprite,o=t.getSDK(),n=t.getOutputDimensions(),r=e.getDOMStyle(o,n),i=this._getAbsoluteSpritePosition(),s=e.getDimensions(o,n);return r.height=Math.min(s.y,n.y-i.y+s.y/2),r},e.prototype._renderKnobs=function(){var e=this,o=t.prototype._renderKnobs.call(this);return["left","right"].forEach(function(t){var r="width-"+t,i=n({},t,!0);o.push(p.React.createElement(p.DraggableComponent,{key:r,onStart:e._onWidthDragStart.bind(e,t),onDrag:e._onWidthDrag,onStop:e._onWidthDragStop},p.React.createElement(f,i)))}),o},e.prototype._getItemControlsProps=function(){return{onDoubleClick:this._onItemDoubleClick,onTouchStart:this._onItemTouchStart,onTouchEnd:this._onItemTouchEnd}},e.prototype._renderContent=function(){var t=this,e=this.props,o=e.sprite,n=e.selected,r=this.state,i=r.editing,s=r.updateBecauseIESucks,a=[];return this.props.hideContent&&!this.state.editing||a.push(p.React.createElement(h,{key:"text-field",editing:i,innerRef:function(e){t._textField=e},style:this._getTextStyle(),defaultValue:o.getText(),onBlur:this._onBlur,onChange:this._onTextChange,updateBecauseIESucks:s})),this.state.editing||a.push(p.React.createElement(d,{key:"disabled-overlay",className:void 0,selected:n})),a},e}(c.a);u.contextTypes=c.a.contextTypes,u.MIN_WIDTH=100,e.a=u;var h=p.adonis.textarea("12u5t8c",{updateBecauseIESucks:"ckktkq",editing:"15kzu1c"},"TextField"),d=p.adonis.div("8gacw5","DisabledOverlay"),f=p.adonis.div("jqmmm4",{left:"tr97e1",right:"1llojum"},"WidthControl")},9:function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=o(0),a=(o.n(s),o(3)),p=function(t){function e(){return n(this,e),r(this,t.apply(this,arguments))}return i(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this);var e=this.props.sprite.getCanvas();this._brush&&this._appendCanvas(e)},e.prototype.componentWillReceiveProps=function(t){if(t.sprite!==this.props.sprite){var e=this.props.sprite.getCanvas();if(e.parentNode.removeChild(e),this._brush){var o=t.sprite.getCanvas();this._appendCanvas(o)}}},e.prototype._appendCanvas=function(t){t.style.width="100%",t.style.height="100%",this._brush.appendChild(t)},e.prototype._renderOverlayControls=function(){return null},e.prototype.render=function(){var t=this;return this.props.hideContent?null:s.React.createElement(c,{innerRef:function(e){t._brush=e}})},e}(a.a);e.a=p;var c=s.adonis.div("8gacw5","BrushItem")}}).default});