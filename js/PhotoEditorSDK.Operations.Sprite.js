!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("photoeditorsdk")):"function"==typeof define&&define.amd?define(["photoeditorsdk"],e):"object"==typeof exports?exports._unexposedPESDK=e(require("photoeditorsdk")):t._unexposedPESDK=e(t.PhotoEditorSDK)}("undefined"!=typeof self?self:this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=99)}({0:function(e,i){e.exports=t},10:function(t,e){t.exports="varying vec2 v_texCoord;\nuniform sampler2D u_image;\n\nuniform float u_gamma;\nuniform float u_shadows;\nuniform float u_highlights;\nuniform mat4 u_colorMatrix;\nuniform vec4 u_colorOffset;\n\nconst float EPSILON = 0.0000001;\nconst vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main() {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  vec4 color = texColor;\n\n  // Apply gamma\n  if (u_gamma != 1.0) {\n    color.rgb = pow(color.rgb, vec3(1.0 / max(u_gamma, EPSILON)));\n  }\n\n  // Apply shadows and highlights\n  float luminance = dot(color.rgb, luminanceWeighting);\n  float shadow = u_shadows >= 0.0\n      ? clamp(\n            pow(luminance, 1.0 / (u_shadows + 1.0))\n            + pow(luminance, 2.0 / (u_shadows + 1.0)) * -0.76\n            - luminance\n      , 0.0, max(u_shadows, 1.0))\n      : -clamp(\n            pow(luminance, 1.0 / (-u_shadows + 1.0))\n            + pow(luminance, 2.0 / (-u_shadows + 1.0)) * -0.76\n            - luminance\n      , 0.0, max(-u_shadows, 1.0));\n\n    float highlight = u_highlights < 0.0\n      ? clamp(\n            1.0\n            - pow(1.0 - luminance, 1.0 / (1.0 - u_highlights))\n            - pow(1.0 - luminance, 2.0 / (1.0 - u_highlights)) * -0.8\n            - luminance\n       , -1.0, 0.0)\n      : -clamp(\n            1.0\n            - pow(1.0 - luminance, 1.0 / (1.0 + u_highlights))\n            - pow(1.0 - luminance, 2.0 / (1.0 + u_highlights)) * -0.8\n            - luminance\n       , -1.0, 0.0);\n\n  // Bright color need more contrast and dark color need more brightness.\n  // This is to keep saturatation because the color information of a dark colors is lost.\n  float shadowContrast   = shadow * luminance * luminance;\n  float shadowBrightness = shadow - shadowContrast;\n  color.rgb = clamp((luminance + highlight + shadowContrast) * ((color.rgb + shadowBrightness) / max(luminance, EPSILON)), 0.0, 1.0);\n\n  // Apply Color Matrix\n  color = clamp(color * u_colorMatrix + u_colorOffset, 0.0, 1.0);\n\n  // Apply alpha\n  color = vec4(color.rgb * texColor.a, texColor.a);\n\n  gl_FragColor = color;\n}\n"},100:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),i(5)),p=i(7),h=s.Math.Vector2,u=s.Math.ColorMatrix,l=function(t){function e(){n(this,e);for(var i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];var u=o(this,t.call.apply(t,[this].concat(r))),l=u._options.image,c=l.src||l.filePath;return u._isSVG=c&&!!c.match(/\w+\.svg(?=\?|$)/i),u._isSVG&&(u._canvas=s.Utils.createCanvas(),u._context=u._canvas.getContext("2d")),l&&u._onImageUpdate(),u._tintFilter=new s.Engine.Filters.TintFilter,u._adjustmentsFilter=new p.a,u._lastRenderedDimensions=h.NULL,u._lastRenderedInputDimensions=h.NULL,u._onOptionsChange=u._onOptionsChange.bind(u),u._options.adjustments.on("updated",u._onOptionsChange),u}return r(e,t),e.prototype.applyScale=function(t){this.setDimensions(this.getDimensions().multiply(t))},e.prototype.serializeOptions=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.prototype.serializeOptions.call(this,e,i);return e||(n.type="sticker"),n},e.prototype._rendersToRenderTexture=function(t){return this._options.smoothDownscaling&&!this._isSVG&&t.getRenderer().isOfType(s.RendererType.WEBGL)||this._hasAdjustments()||"none"!==this._options.tintMode},e.prototype._getTexture=function(){return this._inputTexture},e.prototype.update=function(t,e){var i=this._options,n=i.dimensions,o=i.image;if(n.equals(h.NULL)&&n.set(o.width,o.height),(!this._lastRenderedInputDimensions.equals(e)||!this._lastRenderedDimensions.equals(n)||this._lastRenderedImage!==o)&&this._isSVG&&t.getRenderer().isOfType(s.RendererType.WEBGL)){var r=t.getOutputDimensions();if(n.x>r.x||n.y>r.y){var a=s.Utils.resizeVectorToFit(n,r);o.width=a.x,o.height=a.y}else o.width=n.x,o.height=n.y;this._canvas.width=o.width,this._canvas.height=o.height,this._context.clearRect(0,0,o.width,o.height),this._context.drawImage(o,0,0,o.width,o.height),this._inputTexture.getBaseTexture().update()}this._rendersToRenderTexture(t)&&this._prepareRenderTexture(t);var p=[];if(this._rendersToRenderTexture(t)){if(this._hasAdjustments()){p.push(this._adjustmentsFilter);var l=this._options.adjustments,c=new u;c.multiply(u.createBrightnessMatrix(l.getBrightness())),c.multiply(u.createSaturationMatrix(l.getSaturation())),c.multiply(u.createContrastMatrix(l.getContrast())),this._adjustmentsFilter.set({colorMatrix:c})}this._options.tintMode&&"none"!==this._options.tintMode&&(p.push(this._tintFilter),this._tintFilter.set({mode:s.Engine.Filters.TintFilter.MODES[this._options.tintMode.toUpperCase()],color:this._options.tintColor})),this._renderTextureSprite.setFilters(p)}this._rendersToRenderTexture(t)?this._renderToRenderTexture(t):this._sprite.setTexture(this._inputTexture),this._updateSprite(e),this._applyFlip(),this._lastRenderedDimensions.copy(n),this._lastRenderedInputDimensions.copy(e),this._lastRenderedImage=o},e.prototype._applyFlip=function(){var t=this._sprite.getScale();this._options.flipVertically&&(t.y*=-1),this._options.flipHorizontally&&(t.x*=-1),this._sprite.setScale(t)},e.prototype.applyFlip=function(e){t.prototype.applyFlip.call(this,e);var i={rotation:this._options.rotation},n=i.rotation/Math.PI*180,o=-1*n;switch(i.rotation=o*Math.PI/180,e){case"horizontal":i.flipHorizontally=!this._options.flipHorizontally,this.set(i);break;case"vertical":i.flipVertically=!this._options.flipVertically,this.set(i)}},e.prototype._hasAdjustments=function(){var t=this._options.adjustments;return 0!==t.getBrightness()||1!==t.getSaturation()||1!==t.getContrast()},e.prototype._onImageUpdate=function(){var t=this._options.image,e=this._operation.getSDK().getRenderer();this._isSVG&&e.isOfType(s.RendererType.WEBGL)&&(t=this._canvas),this._inputTexture=s.Engine.Texture.fromImage(t),this._identitySprite.setTexture(this._inputTexture),this._sprite.setTexture(this._inputTexture),this._renderTexture&&(this._renderTextureSprite.setTexture(this._inputTexture),this._renderTexture.resizeTo(this._inputTexture.getDimensions())),this.setDirty(!0)},e.prototype.setOption=function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.prototype.setOption.call(this,e,i,n),"image"===e&&this._identitySprite&&this._onImageUpdate()},e.prototype._onOptionsChange=function(){var t=this._dirtiness;for(var e in t)t[e]=!0},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._inputTexture.getBaseTexture().dispose(),this._inputTexture=null,this._options.adjustments.off("updated",this._onOptionsChange)},e}(a.a);l.prototype.availableOptions={id:{type:s.OptionType.STRING,default:function(){return s.Utils.getUUID()}},identifier:{type:s.OptionType.STRING,default:""},image:{type:s.OptionType.IMAGE,required:!0},position:{type:s.OptionType.VECTOR2,default:h.NULL},dimensions:{type:s.OptionType.VECTOR2,default:h.NULL},anchor:{type:s.OptionType.VECTOR2,default:new h(0,0)},pivot:{type:s.OptionType.VECTOR2,default:new h(.5,.5)},rotation:{type:s.OptionType.NUMBER,default:0},flipHorizontally:{type:s.OptionType.BOOLEAN,default:!1},flipVertically:{type:s.OptionType.BOOLEAN,default:!1},smoothDownscaling:{type:s.OptionType.BOOLEAN,default:!1},tintColor:{type:s.OptionType.COLOR,default:s.Color.WHITE},tintMode:{type:s.OptionType.STRING,default:"none",available:["none","solid","colorized"]},alpha:{type:s.OptionType.NUMBER,default:1},adjustments:{type:s.OptionType.CONFIGURABLE,structure:{brightness:{type:s.OptionType.NUMBER,default:0},saturation:{type:s.OptionType.NUMBER,default:1},contrast:{type:s.OptionType.NUMBER,default:1}}}},l.type="sticker",e.a=l},101:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),i(5)),p=i(102),h=s.Math.Vector2,u=function(t){function e(){n(this,e);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];var a=o(this,t.call.apply(t,[this].concat(r)));return a._textRenderer=new p.a(a,a._operation),a._textRenderer.rotation=a.getRotation(),a._sprite.setTexture(a._textRenderer.getFinalTexture()),a._hitTestSprite.setTexture(a._textRenderer.getTexture()),a}return r(e,t),e.prototype.serializeOptions=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.prototype.serializeOptions.call(this,e,i);return e||(n.type="text"),n},e.prototype.getDOMStyle=function(t,e){var i=this.getFontSize()*e.y;return{fontWeight:this._options.fontWeight,fontSize:i+"px",fontStyle:this._options.fontStyle,fontFamily:this._options.fontFamily,lineHeight:this.getAbsoluteTextHeight(e)*this.getLineHeight()+"px",color:this._options.color.toRGBA(),backgroundColor:this._options.backgroundColor.toRGBA(),textAlign:this._options.alignment}},e.prototype.getAbsoluteTextHeight=function(t){var e=this.getFontSize()*t.y,i=this.getTextMetrics();if(i){var n=1/i.unitsPerEm*e,o=i.ascender*n,r=i.descender*n;return o+Math.abs(r)}return e*this.getLineHeight()*1.1},e.prototype.getDimensions=function(t,e){return this._textRenderer.getDimensions(t,e)},e.prototype.applyFlip=function(e){t.prototype.applyFlip.call(this,e);var i=this._options.rotation;switch(e){case"horizontal":i+=2*(Math.PI-i),this.setRotation(i);break;case"vertical":i+=2*(Math.PI/2-i),this.setRotation(i)}},e.prototype.applyTransform=function(e){t.prototype.applyTransform.call(this,e),this.set({fontSize:e.scaleSize(this.getFontSize(),"y"),maxWidth:e.scaleSize(this.getMaxWidth(),"x")},!1)},e.prototype.applyRotation=function(e){t.prototype.applyRotation.call(this,e);var i=(e+360)%360,n=this._operation.getInputDimensions();90!==i&&270!==i||(this.setMaxWidth(this.getMaxWidth()/n.x*n.y),this.setFontSize(this.getFontSize()/n.y*n.x))},e.prototype.setOption=function(e,i){if("rotation"===e)return this._options.rotation=i,this._textRenderer&&(this._textRenderer.rotation=i),this._rotation=i,void this.emit("update");t.prototype.setOption.call(this,e,i)},e.prototype.getOption=function(e){return"rotation"===e?this._rotation:t.prototype.getOption.call(this,e)},e.prototype.getHitTestDisplayObject=function(){return this._hitTestSprite},e.prototype.update=function(e,i){if(this._sprite.setVisible(this._options.visible),this._options.visible){this._textRenderer.update(e,i);var n=this._textRenderer.getFinalTexture();n.getBaseTexture().update();var o=e.getRenderer();o.isOfType(s.RendererType.WEBGL)&&o.updateTexture(n.getBaseTexture()),t.prototype.update.call(this,e,i),this._sprite.setRotation(0),this._textRenderer.getTexture().getBaseTexture().update(),this._hitTestSprite.setRotation(this._rotation),this._hitTestSprite.updateTransform()}},e.prototype._getTexture=function(){return this._textRenderer.getFinalTexture()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._textRenderer.dispose()},e}(a.a);u.prototype.availableOptions={id:{type:s.OptionType.STRING,default:function(){return s.Utils.getUUID()}},fontSize:{type:s.OptionType.NUMBER,default:.1},characterSpacing:{type:s.OptionType.NUMBER,default:0},lineHeight:{type:s.OptionType.NUMBER,default:1.1},fontIdentifier:{type:s.OptionType.STRING},fontFamily:{type:s.OptionType.STRING,default:"Times New Roman"},fontWeight:{type:s.OptionType.ALL,default:"normal"},fontStyle:{type:s.OptionType.STRING,default:"normal"},textMetrics:{type:s.OptionType.OBJECT,default:null},outlineWidth:{type:s.OptionType.NUMBER,default:0},outlineColor:{type:s.OptionType.COLOR,default:s.Color.BLACK},alignment:{type:s.OptionType.STRING,default:"left",available:["left","center","right"]},verticalAlignment:{type:s.OptionType.STRING,default:"top",available:["top","center","bottom"]},color:{type:s.OptionType.COLOR,default:new s.Color(1,0,0,1)},backgroundColor:{type:s.OptionType.COLOR,default:s.Color.TRANSPARENT},position:{type:s.OptionType.VECTOR2,default:new h(.5,.5)},anchor:{type:s.OptionType.VECTOR2,default:new h(0,0)},pivot:{type:s.OptionType.VECTOR2,default:new h(.5,.5)},rotation:{type:s.OptionType.NUMBER,default:0},text:{type:s.OptionType.STRING,required:!0},maxWidth:{type:s.OptionType.NUMBER,default:.5},maxHeight:{type:s.OptionType.NUMBER,default:0},visible:{type:s.OptionType.BOOLEAN,default:!0}},u.type="text",e.a=u},102:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=i(0),r=(i.n(o),i(103)),s=o.Math.Vector2,a=function(){function t(e,i){n(this,t),this._text=e,this._operation=i,this._textOptions={},this.rotation=0,this._createCanvas(),this._createTexture()}return t.prototype._createCanvas=function(){this._canvas=o.Utils.createCanvas(),this._context=this._canvas.getContext("2d"),this._textSplitter=new r.a(this._context),this._finalCanvas=o.Utils.createCanvas(),this._finalContext=this._finalCanvas.getContext("2d")},t.prototype._createTexture=function(){this._texture=o.Engine.Texture.fromCanvas(this._canvas),this._finalTexture=o.Engine.Texture.fromCanvas(this._finalCanvas)},t.prototype._applyTextOptions=function(t,e){e.font=this._text.getFontStyle()+" "+this._text.getFontWeight()+" "+t.fontSize+'px "'+this._text.getFontFamily()+'"',e.textBaseline="top",e.textAlign=this._text.getAlignment(),e.fillStyle=this._text.getColor().toRGBA(),e.strokeStyle=this._text.getOutlineColor().toRGBA();var i=this._text.getOutlineWidth();i>0&&(e.lineWidth=i)},t.prototype._buildOutputLines=function(t){return this._textSplitter.setText(this._text.getText()),this._textSplitter.setMaxWidth(t),this._textSplitter.getLines()},t.prototype._renderTextLine=function(t,e){var i=this._text.getAlignment(),n=new s(0,e);switch(i){case"center":n.x=this._canvas.width/2;break;case"right":n.x=this._canvas.width}this._context.fillText(t,n.x,n.y),this._text.getOutlineWidth()>0&&(this._context.miterLimit=2,this._context.strokeText(t,n.x,n.y))},t.prototype.update=function(t,e){var i=this.calculateFontStyles(t,e);if(i){var n=this._calculateText(t,i,e),o=n.dimensions,r=n.lines;this._renderText(t,o,r,i,e),this._updateFinalTexture()}},t.prototype._updateFinalTexture=function(){var t=this._canvas,e=t.width,i=t.height,n=this.rotation,o=Math.cos(n),r=Math.sin(n),a=new s(Math.abs(e*o)+Math.abs(i*r),Math.abs(e*r)+Math.abs(i*o));this._finalCanvas.width=a.x,this._finalCanvas.height=a.y,this._finalContext.save(),this._finalContext.translate(this._finalCanvas.width/2,this._finalCanvas.height/2),this._finalContext.rotate(n),this._finalContext.drawImage(this._canvas,-e/2,-i/2),this._finalContext.restore()},t.prototype._renderText=function(t,e,i,n,o){this._canvas.width=e.x,this._canvas.height=e.y,this._text.getMaxHeight()&&(this._canvas.height=Math.min(this._text.getMaxHeight()*o.y,this._canvas.height)),this._context=this._canvas.getContext("2d"),this._context.fillStyle=this._text.getBackgroundColor().toRGBA(),this._context.fillRect(0,0,e.x,e.y),this._applyTextOptions(n,this._context);for(var r=0;r<i.length;r++){var s=i[r];this._renderTextLine(s,n.topPadding+n.lineHeight*r)}},t.prototype.calculateFontStyles=function(t,e){var i=this._text.getFontFamily(),n=this._text.getFontSize()*e.y,o=this._text.getAbsoluteTextHeight(e),r=o*this._text.getLineHeight(),s=o*(this._text.getLineHeight()-1)/2,a={fontFamily:i,fontSize:n,lineHeight:r,topPadding:s};return this._textOptions.fontFamily===i&&this._textOptions.fontSize===n&&this._textOptions.lineHeight===r||(this._textOptions=a),a},t.prototype._calculateText=function(t,e,i){var n=this._text.getMaxWidth()*i.x;this._applyTextOptions(e,this._context);var o=new s,r=this._text.getText().split("\n");if(void 0!==n)o.x=n,r=this._buildOutputLines(n);else for(var a=0;a<r.length;a++){var p=r[a];o.x=Math.max(o.x,this._context.measureText(p).width)}var h=e.lineHeight;return o.y=r.length*h,{dimensions:o,lines:r}},t.prototype.getTexture=function(){return this._texture},t.prototype.getFinalTexture=function(){return this._finalTexture},t.prototype.getDimensions=function(t,e){var i=this.calculateFontStyles(t,e);return this._calculateText(t,i,e).dimensions},t.prototype.dispose=function(){this._measurementElement&&document.body.removeChild(this._measurementElement),this._texture.getBaseTexture().dispose(),this._texture=null,this._finalTexture.getBaseTexture().dispose(),this._finalTexture=null},t}();e.a=a},103:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e){n(this,t),this._context=e,this._lastFontStyle={}}return t.prototype.getLines=function(){for(var t=this,e=[],i=[],n=this._lines.length,o=0;o<n;o++){for(var r=this._lines[o],s=this._buildWords(r),a=s.length,p=0;p<a;p++){var h=s[p],u=i.concat(h).join("").replace(/\s+$/i,"");if(this._getWidth(u)>this._maxWidth){i.length>0&&(e.push(i.join("")),i=[h]);var l=h.replace(/\s+$/i,"");if(this._getWidth(l)>this._maxWidth){var c=this._splitWord(h);e=e.concat(c.lines),c.rest&&(i=[c.rest])}}else i.push(h)}e.push(i.join("")),i=[]}return e.map(function(e){return t._trimLine(e,t._context.textAlign)})},t.prototype._trimLine=function(t,e){return t},t.prototype._buildWords=function(t){for(var e=[],i="",n=t.length,o=0;o<n;o++){var r=t[o];i+=r," "!==r&&"-"!==r&&o!==n-1||(e.push(i),i="")}return e},t.prototype._splitWord=function(t){for(var e={lines:[],rest:null},i=t.length,n=[],o=0;o<i;o++){var r=t[o];this._getWidth(n.concat(r).join(""))>this._maxWidth?(n.length>0&&e.lines.push(n.join("")),n=[r]):n.push(r),o===i-1&&n.length>0&&(e.rest=n.join(""))}return e},t.prototype._fontStyleChanged=function(){return this._context.font!==this._lastFontStyle&&(this._lastFontStyle=this._context.font,!0)},t.prototype._getWidth=function(t){return this._context.measureText(t).width},t.prototype.setText=function(t){this._text=t,this._lines=t.split("\n")},t.prototype.setMaxWidth=function(t){this._maxWidth=t},t}();e.a=o},14:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),i(15)),p=function(t){function e(i,r,a){n(this,e);var p=o(this,t.call(this,r));return p._operation=i,p._canvas=a||s.Utils.createCanvas(),p._context=p._canvas.getContext("2d"),p}return r(e,t),e.prototype.serializeOption=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"controlPoints"===e?this._options.controlPoints.map(function(t){var e=t.getPosition();return i?e.toObject():e.clone()}):t.prototype.serializeOption.call(this,e,i)},e.prototype._optionEquals=function(e,i){if("controlPoints"===e){for(var n=this._options.controlPoints,o=0,r=n.length;o<r;o++)if(!n[o].getPosition().equals(i[o]))return!1;return!0}return t.prototype._optionEquals.call(this,e,i)},e.prototype.render=function(t){var e=this._options,i=e.controlPoints,n=e.size;if(!(i.length<2)){s.Utils.ensureCanvasDimensions(this._canvas,t),this._brush&&this._lastBrushSize===n&&t.equals(this._brushInputDimensions)||(this._brushInputDimensions=t.clone(),this._lastBrushSize=n);for(var o=i[0],r=o,a=1;a<i.length;a++)r=i[a],r.renderToCanvas(this._options.brush.getBrushImage(t),this._canvas,o),o=r}},e.prototype._createBrush=function(t){var e=this._options,i=e.size,n=e.hardness,o=e.color,r=s.Utils.createCanvas();r.width=r.height=Math.ceil(i*t.min());var a=r.getContext("2d");if(o=o.clone(),o.a=1,1===r.width)a.fillStyle=o.toRGBA(),a.fillRect(0,0,1,1);else{var p=a.createRadialGradient(r.width/2,r.height/2,Math.min(r.width/2-1,r.width/2*n),r.width/2,r.height/2,r.width/2);p.addColorStop(0,o.toRGBA());var h=o.clone();h.a=0,p.addColorStop(1,h.toRGBA()),a.fillStyle=p,a.fillRect(0,0,r.width,r.height)}return r},e.prototype.addControlPoint=function(t){var e=new a.a(this,t);this._options.controlPoints.push(e),this.emit("update",this)},e.prototype.getCanvas=function(){return this._canvas},e.prototype.setCanvas=function(t){this._canvas=t,this._context=t.getContext("2d")},e.prototype.setDirty=function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._options.controlPoints.forEach(function(t){t.setDirty()})},e.prototype.forEachControlPoint=function(t){this._options.controlPoints.forEach(t)},e.prototype.renderToCanvas=function(t){var e=t.getContext("2d");e.save(),e.globalAlpha=this._options.brush.getColor().a,e.drawImage(this._canvas,0,0),e.restore()},e.prototype.getCanvasDimensions=function(){return this._canvasDimensions},e}(s.Configurable);p.prototype.availableOptions={id:{type:s.OptionType.STRING,default:function(){return s.Utils.getUUID()}},brush:{type:s.OptionType.OBJECT,required:!0},controlPoints:{type:s.OptionType.ARRAY,default:[]},closed:{type:s.OptionType.BOOLEAN,default:!1}},e.a=p},15:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=i(0),r=(i.n(o),o.Math.Vector2),s=function(){function t(e,i){n(this,t),this._path=e,this._drawnCanvases=[],this._position=i}return t.prototype.renderToCanvas=function(t,e,i){if(-1===this._drawnCanvases.indexOf(e)){for(var n=new r(e.width,e.height),o=e.getContext("2d"),s=this._position.clone().multiply(n),a=i.getPosition().clone().multiply(n),p=s.clone().subtract(a).len(),h=t.width/10,u=0;u<=p;){var l=Math.max(0,Math.min(1,u/p)),c=a.x+(s.x-a.x)*l,f=a.y+(s.y-a.y)*l;o.drawImage(t,c-t.width/2,f-t.height/2,t.width,t.height),u+=h}this._drawnCanvases.push(e)}},t.prototype.setPosition=function(t){this._position=t},t.prototype.getPosition=function(){return this._position.clone()},t.prototype.setDirty=function(){this._drawnCanvases=[]},t}();e.a=s},16:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),i(6)),p=function(t){function e(){return n(this,e),o(this,t.apply(this,arguments))}return r(e,t),e.prototype.getBrushImage=function(t){if(this._brush&&this.optionsEqual(this._lastOptions)&&t.equals(this._lastInputDimensions))return this._brush;var e=this._options,i=e.size,n=e.hardness,o=e.color,r=s.Utils.createCanvas();r.width=r.height=Math.ceil(i*t.min());var a=r.getContext("2d");if(o=o.clone(),o.a=1,1===r.width)a.fillStyle=o.toRGBA(),a.fillRect(0,0,1,1);else{var p=a.createRadialGradient(r.width/2,r.height/2,Math.min(r.width/2-1,r.width/2*n),r.width/2,r.height/2,r.width/2);p.addColorStop(0,o.toRGBA());var h=o.clone();h.a=0,p.addColorStop(1,h.toRGBA()),a.fillStyle=p,a.fillRect(0,0,r.width,r.height)}return this._lastOptions=this.serializeOptions(["size","color","hardness"]),this._brush=r,this._lastInputDimensions=t.clone(),r},e}(a.a);e.a=p,p.identifier="imgly_brush_radial",p.prototype.availableOptions=s.Utils.extend(a.a.prototype.availableOptions,{hardness:{type:s.OptionType.NUMBER,default:1}})},5:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),s.Math.Vector2),p=function(t){function e(i,r){n(this,e);var a=o(this,t.call(this,r));return a._operation=i,a._dirtiness={},a.id=s.Utils.getUUID(),a._renderTextures={},a._identitySprite=new s.Engine.Sprite,a._sprite=new s.Engine.Sprite,a._dummyImage={addEventListener:function(){},removeEventListener:function(){}},a._hitTestSprite=new s.Engine.Sprite,a._renderers=[],a}return r(e,t),e.prototype.applyScale=function(t){},e.prototype.applyRotation=function(t){var e=this._operation.getInputDimensions(),i=180*this.getRotation()/Math.PI;i+=t,this.setRotation(i*Math.PI/180);var n=(t+360)%360,o=n*Math.PI/180,r=Math.cos(o),s=Math.sin(o),p=this._options.position.clone().subtract(.5).multiply(e),h=new a(p.x*r-p.y*s,p.x*s+p.y*r).divide(e.clone().flip());this.setPosition(new a(.5,.5).add(h))},e.prototype.applyFlip=function(t){var e=this.getPosition().clone();switch(t){case"horizontal":e.x=1-this._options.position.x;break;case"vertical":e.y=1-this._options.position.y}this.setPosition(e)},e.prototype.applyTransform=function(t){var e={};e.rotation=t.applyToRotation(this.getRotation()),e.position=t.applyToRelativePoint(this.getPosition()),this._options.dimensions&&(e.dimensions=t.applyToDimensions(this.getDimensions())),this.set(e,!1)},e.prototype.getDisplayObject=function(){return this._sprite},e.prototype.getHitTestDisplayObject=function(){return this._sprite},e.prototype._getTexture=function(){throw new Error("Sprite#_getTexture is abstract and not implemented in child class.")},e.prototype._prepareRenderTexture=function(t){if(this._renderTexture)this._renderTexture.clear();else{var e=this._getTexture();this._renderTextureContainer=new s.Engine.Container,this._renderTextureSprite=new s.Engine.Sprite(e),this._renderTextureContainer.addChild(this._renderTextureSprite),this._renderTexture=this._getRenderTexture(t.getRenderer(),e.getDimensions())}},e.prototype._rendersToRenderTexture=function(t){return t.getOptions().smoothDownscaling&&t.getRenderer().isOfType(s.RendererType.WEBGL)},e.prototype._optionEquals=function(e,i){return"type"===e||t.prototype._optionEquals.call(this,e,i)},e.prototype.update=function(t,e){this._rendersToRenderTexture(t)&&(this._prepareRenderTexture(t),this._renderToRenderTexture(t)),this._updateSprite(e)},e.prototype._updateSprite=function(t){var e=this;[this._sprite,this._hitTestSprite].forEach(function(i){if(i.getTexture()){i.setAnchor(e._options.anchor),i.setPosition(e._options.position.clone().multiply(t)),void 0!==e._options.alpha&&i.setAlpha(e._options.alpha);var n=e._options.dimensions;n&&(n=n.clone().multiply(e._operation.getSDK().getTextureScale()),i.setWidth(n.x),i.setHeight(n.y)),i.updateTransform();var o=i.getTexture().getFrame(),r=new a(o.width,o.height);i.setPivot(e._options.pivot.clone().multiply(r)),i.setRotation(e._options.rotation),i.updateTransform()}})},e.prototype._renderToRenderTexture=function(t){var e=this._getTexture().getDimensions(),i=this._getRenderTexture(t.getRenderer(),e),n=e.clone();if(this._options.smoothDownscaling&&(n.x=s.Utils.nextHighestPOT(n.x),n.y=s.Utils.nextHighestPOT(n.y)),this._renderTexture.resizeTo(n),this._renderTexture.render(this._renderTextureContainer),this._options.smoothDownscaling){var o=n.clone().subtract(e.x,e.y).divide(n),r=i.getUVs().getUVs();r[0].x=r[3].x=0,r[1].x=r[2].x=1-o.x,r[0].y=r[1].y=0,r[2].y=r[3].y=1-o.y}this._sprite.setTexture(i)},e.prototype.isDirtyForRenderer=function(t){return t.id in this._dirtiness||(this._dirtiness[t.id]=!0),this._dirtiness[t.id]},e.prototype.setDirtyForRenderer=function(t,e){this._renderers[e.id]=e,this._dirtiness[e.id]=t},e.prototype.setDirty=function(t){for(var e in this._dirtiness)this.setDirtyForRenderer(t,this._renderers[e])},e.prototype._getRenderTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a(100,100);return this._renderTextures[t.id]||(this._renderTextures[t.id]=new s.Engine.RenderTexture(t,e.x,e.y,1)),this._renderTextures[t.id]},e.prototype.dispose=function(){for(var t in this._renderTextures)this._renderTextures[t].dispose()},e}(s.Configurable);e.a=p},6:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),s.Math.Vector2),p=function(t){function e(){n(this,e);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];var p=o(this,t.call.apply(t,[this].concat(r)));return p._lastOptions={},p._lastInputDimensions=new a(0,0),p._brush=null,p}return r(e,t),e.prototype.getBrushImage=function(t){if(this._brush&&this.optionsEqual(this._lastOptions)&&t.equals(this._lastInputDimensions))return this._brush;var e=this._options,i=e.image,n=e.size;i.width=i.height=Math.ceil(n*t.min());var o=s.Utils.createCanvas();o.width=i.width,o.height=i.height;var r=o.getContext("2d");r.drawImage(i,0,0,o.width,o.height);var a=this._tintImageData(r.getImageData(0,0,o.width,o.height),o.width,o.height);return r.putImageData(a,0,0),this._lastOptions=this.serializeOptions(["size","color"]),this._brush=o,this._lastInputDimensions=t.clone(),o},e.prototype._tintImageData=function(t){for(var e=this._options.color,i=0;i<t.data.length;i+=4)t.data[i]+=(255*e.r-t.data[i])*e.a,t.data[i+1]+=(255*e.g-t.data[i+1])*e.a,t.data[i+2]+=(255*e.b-t.data[i+2])*e.a;return t},e.prototype.clone=function(){return new(0,this.constructor)(this._options)},e}(s.Configurable);e.a=p,p.prototype.availableOptions={identifier:{type:s.OptionType.STRING},image:{type:s.OptionType.IMAGE},size:{type:s.OptionType.NUMBER,default:.05},color:{type:s.OptionType.COLOR,default:s.Color.RED}}},7:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),s.Math.ColorMatrix),p=function(t){function e(){n(this,e);var r=o(this,t.call(this));return r._fragmentSource=i(10),r}return r(e,t),e.prototype._applyCanvas=function(t,e,i){for(var n=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],e.getCanvas()),o=e.getContext(),r=i.getContext(),a=o.getImageData(0,0,n.width,n.height),p=this._options,h=p.colorMatrix,u=p.gamma,l=p.shadows,c=p.highlights,f=1!==u,y=0!==l||0!==c,d=new s.Color(0,0,0,0),_=0;_<n.width*n.height;_++){var g=4*_;if(d.r=a.data[g]/255,d.g=a.data[g+1]/255,d.b=a.data[g+2]/255,f&&(d.r=Math.pow(d.r,1/Math.max(u,1e-7)),d.g=Math.pow(d.g,1/Math.max(u,1e-7)),d.b=Math.pow(d.b,1/Math.max(u,1e-7))),y){var x=.2125*d.r+.7154*d.g+.0721*d.b,v=l>=0?s.Utils.clamp(Math.pow(x,1/(l+1))+-.76*Math.pow(x,2/(l+1))-x,0,Math.max(l,1)):-s.Utils.clamp(Math.pow(x,1/(1-l))+-.76*Math.pow(x,2/(1-l))-x,0,Math.max(-l,1)),T=c<0?s.Utils.clamp(1-Math.pow(1-x,1/(1-c))- -.8*Math.pow(1-x,2/(1-c))-x,-1,0):-s.Utils.clamp(1-Math.pow(1-x,1/(1+c))- -.8*Math.pow(1-x,2/(1+c))-x,-1,0),m=v*x*x,O=v-m,w=x+m+T;d.r=s.Utils.clamp(w*((d.r+O)/Math.max(x,1e-7)),0,1),d.g=s.Utils.clamp(w*((d.g+O)/Math.max(x,1e-7)),0,1),d.b=s.Utils.clamp(w*((d.b+O)/Math.max(x,1e-7)),0,1)}d=h.apply(d),a.data[g]=255*d.r,a.data[g+1]=255*d.g,a.data[g+2]=255*d.b}r.putImageData(a,0,0)},e}(s.Engine.Filter);p.prototype.availableOptions={gamma:{type:s.OptionType.NUMBER,default:1,uniformType:s.UniformType.FLOAT},shadows:{type:s.OptionType.NUMBER,default:0,uniformType:s.UniformType.FLOAT},highlights:{type:s.OptionType.NUMBER,default:1,uniformType:s.UniformType.FLOAT},colorMatrix:{type:s.OptionType.COLOR_MATRIX,default:new a,uniformType:s.UniformType.MAT4},colorOffset:{type:s.OptionType.ARRAY,default:[],uniformType:s.UniformType.FLOAT4}},e.a=p},9:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=i(0),a=(i.n(s),i(14)),p=i(5),h=i(6),u=i(16),l=s.Math.Vector2,c=function(t){function e(){n(this,e);for(var i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];var p=o(this,t.call.apply(t,[this].concat(r)));return p._persistedPaths=[],p._outputCanvasDirty=!0,p._outputCanvas=s.Utils.createCanvas(),p._outputContext=p._outputCanvas.getContext("2d"),p._persistCanvas=s.Utils.createCanvas(),p._persistContext=p._persistCanvas.getContext("2d"),p._nextCanvas=s.Utils.createCanvas(),p._texture=s.Engine.Texture.fromCanvas(p._outputCanvas),p._sprite.setTexture(p._texture),p._onPathUpdate=p._onPathUpdate.bind(p),p}return r(e,t),e.prototype.applyFlip=function(t){this._options.paths.forEach(function(e){e.forEachControlPoint(function(e){var i=e.getPosition().clone();switch(t){case"horizontal":i.x=1-i.x;break;case"vertical":i.y=1-i.y}e.setPosition(i)}),e.setDirty(!0)}),this._reset()},e.prototype.applyRotation=function(t){this._options.paths.forEach(function(e){e.forEachControlPoint(function(e){var i=e.getPosition().clone();90===t?(i.flip(),i.x=1-i.x):-90===t&&(i.flip(),i.y=1-i.y),e.setPosition(i)}),e.setDirty(!0)}),this._reset()},e.prototype.applyTransform=function(t){var e=null;this._options.paths.forEach(function(i){i.forEachControlPoint(function(e){e.setPosition(t.applyToRelativePoint(e.getPosition()))});var n=i.getBrush();n!==e&&(n.setSize(t.applyToRelativeSize(n.getSize())),e=n),i.setDirty(!0)}),this._reset()},e.prototype.clearCanvas=function(){if(this._outputCanvas){this._outputCanvasDirty=!0;var t=this._outputCanvas,e=t.width,i=t.height;this._outputContext.clearRect(0,0,e,i)}},e.prototype.clearPersistCanvas=function(){if(this._persistCanvas){var t=this._persistCanvas,e=t.width,i=t.height;this._persistContext.clearRect(0,0,e,i)}},e.prototype.serializeOptions=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.prototype.serializeOptions.call(this,e,i);return e||(n.type="brush"),n},e.prototype.serializeOption=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"paths"===e?this._options.paths.map(function(t){return t.serializeOptions(void 0,i)}):t.prototype.serializeOption.call(this,e,i)},e.prototype.createPath=function(t){var e=new a.a(this._operation,{brush:t},this._nextCanvas);return e.on("update",this._onPathUpdate),this._options.paths.push(e),this.setDirty(!0),e},e.prototype._onPathUpdate=function(){this._operation.setDirty(!0),this.setDirty(!0)},e.prototype._onPathPersist=function(t){t.renderToCanvas(this._persistCanvas),this._nextCanvas=t.getCanvas(),this._nextCanvas.getContext("2d").clearRect(0,0,this._nextCanvas.width,this._nextCanvas.height),this._persistedPaths.push(t)},e.prototype._getTexture=function(){return this._texture},e.prototype.setDirtyForRenderer=function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.prototype.setDirtyForRenderer.call(this,e,i,n),e&&n&&(this._persistedPaths=[],this._options.paths.forEach(function(t){t.setDirty(!0)}))},e.prototype.setDirty=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var i in this._dirtiness)this.setDirtyForRenderer(t,this._renderers[i],e)},e.prototype.render=function(t){var e=this,i=this._operation.getSDK().getRenderer();this.isDirtyForRenderer(i)&&(s.Utils.ensureCanvasDimensions(this._outputCanvas,t),s.Utils.ensureCanvasDimensions(this._persistCanvas,t),this._options.paths.forEach(function(i){i.render(t),i.getClosed()&&-1===e._persistedPaths.indexOf(i)&&e._onPathPersist(i)}),this.clearCanvas(),this._outputContext.drawImage(this._persistCanvas,0,0),this._options.paths.forEach(function(t){t.getClosed()||t.renderToCanvas(e._outputCanvas)}),this.setDirtyForRenderer(!1,i))},e.prototype.update=function(e,i){i&&(s.Utils.ensureCanvasDimensions(this._outputCanvas,i),s.Utils.ensureCanvasDimensions(this._persistCanvas,i),this._texture.getBaseTexture().update()),this.render(i);var n=e.getRenderer();n.isOfType(s.RendererType.WEBGL)&&n.updateTexture(this._texture.getBaseTexture()),t.prototype.update.call(this,e,i)},e.prototype._reset=function(){this._persistedPaths=[],this._operation&&this._operation.setDirty(!0),this.setDirty(!0),this.clearCanvas(),this.clearPersistCanvas()},e.prototype.getCanvas=function(){return this._outputCanvas},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._texture.getBaseTexture().dispose()},e}(p.a);c.prototype.availableOptions={id:{type:s.OptionType.STRING,default:function(){return s.Utils.getUUID()}},position:{type:s.OptionType.VECTOR2,default:new l(0,0)},scale:{type:s.OptionType.VECTOR2,default:new l(1,1)},anchor:{type:s.OptionType.VECTOR2,default:new l(0,0)},pivot:{type:s.OptionType.VECTOR2,default:new l(0,0)},rotation:{type:s.OptionType.NUMBER,default:0},paths:{type:s.OptionType.ARRAY,default:[],setter:function(t){var e=this;return t=t.map(function(t){if(t instanceof a.a)return t;var i=t.brush,n=t.closed,o=new a.a(e._operation,{brush:i,closed:n},e._nextCanvas);return t.controlPoints.forEach(function(t){o.addControlPoint(t)}),o}),this._reset(),t}}},c.type="brush",c.Brush=h.a,c.Path=a.a,c.Brushes={RadialBrush:u.a},e.a=c},99:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),a=i.n(s),p=i(5),h=i(100),u=i(101),l=i(9),c=function(t){function e(){n(this,e);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];var a=o(this,t.call.apply(t,[this].concat(r)));return a._onSpriteUpdate=a._onSpriteUpdate.bind(a),a._options.sprites.slice().forEach(function(t){a.removeSprite(t),a.addSprite(t)}),a}return r(e,t),e.prototype.getSpritesOfType=function(t){return this._options.sprites.filter(function(e){return e instanceof t})},e.prototype.rotate=function(t){this._options.sprites.forEach(function(e){e.applyRotation(t)})},e.prototype.flip=function(t){this._options.sprites.forEach(function(e){e.applyFlip(t)})},e.prototype._onSpriteUpdate=function(t,e){this.setDirty(!0)},e.prototype._applyRotation=function(t,e){this._options.sprites.forEach(function(i){return i.applyRotation(t,e)})},e.prototype.transform=function(t){this._options.sprites.forEach(function(e){return e.applyTransform(t)})},e.prototype.scale=function(t){this._options.sprites.forEach(function(e){return e.applyScale(t)})},e.prototype.serializeOption=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"sprites"===e?this._options.sprites.map(function(t){return t.serializeOptions(void 0,i)}):t.prototype.serializeOption.call(this,e,i)},e.prototype.createSticker=function(t){return new h.a(this,t)},e.prototype.createText=function(t){return new u.a(this,t)},e.prototype.createBrush=function(t){return new l.a(this,t)},e.prototype.addSprite=function(t){this._options.sprites.push(t),this._container.addChild(t.getDisplayObject()),this.setDirty(!0),t.on("update",this._onSpriteUpdate)},e.prototype.removeSprite=function(t){var e=this._options.sprites,i=e.indexOf(t);return-1!==i&&(t.off("update",this._onSpriteUpdate),this._container.removeChild(t.getDisplayObject()),e.splice(i,1),this.setDirty(!0),!0)},e.prototype._render=function(t){var e=this,i=this._container,n=this._options.sprites,o=t.getDimensions().clone().floor();return s.Promise.all(n.map(function(t){return t.validateSettings()})).then(function(){n.forEach(function(t){return t.update(e._sdk,o)})}).then(function(){e._renderTexture.clear(),e._renderTexture.render(i)})},e.prototype.takeSpriteToFront=function(t){var e=this._options.sprites,i=e.indexOf(t);if(-1!==i){s.Utils.moveArrayItem(e,i,e.length-1);var n=t.getDisplayObject();this._container.removeChild(n),this._container.addChild(n),this.setDirty(!0)}},e.prototype.getSpritesAtPosition=function(t,e){var i=this,n=[];this._options.sprites.forEach(function(t){return t.update(i._sdk,e)});var o=this._sdk.getSprite(),r=o.getWorldTransform().applyInverseToVector(t),s=o.getTexture().getFrame(),a=s.width,p=s.height,h=o.getAnchor().clone().multiply(-a,-p);r.subtract(h);for(var u=this._options.sprites.slice(0).reverse(),l=0,c=u.length;l<c;l++){var f=u[l];f.getHitTestDisplayObject().isAtPosition(r)&&n.push(f)}return n},e.prototype.setDirtyForRenderer=function(e,i,n){t.prototype.setDirtyForRenderer.call(this,e,i,n),this._options.sprites.forEach(function(t){t.setDirtyForRenderer(e,i,n)})},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._options.sprites.forEach(function(t){t.dispose()})},e}(s.Operation);c.StickerSprite=h.a,c.TextSprite=u.a,c.BrushSprite=l.a,c.identifier="sprite",c.prototype.availableOptions={sprites:{type:s.OptionType.ARRAY,default:[],setter:function(t,e){var i=this;if(t=t.map(function(t,e){if(t instanceof p.a)return t;var n=t.type;switch(delete t.type,n){case"text":return new u.a(i,t);case"sticker":return new h.a(i,t);case"brush":return new l.a(i,t);default:s.Log.error(i.constructor.name,"Invalid sprite type: "+t.type)}}),!e){if(this._options.sprites){this._options.sprites.slice().forEach(function(t){t.dispose(),i.removeSprite(t)})}t.forEach(function(t){i.addSprite(t)})}return t}}},a.a.Operations.SpriteOperation=c,e.default=c}}).default});