!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("photoeditorsdk/PhotoEditorSDK.UI.DesktopUI.Core"),require("photoeditorsdk")):"function"==typeof define&&define.amd?define([["PhotoEditorSDK","UI","DesktopUI"],"photoeditorsdk"],t):"object"==typeof exports?exports._unexposedPESDK=t(require("photoeditorsdk/PhotoEditorSDK.UI.DesktopUI.Core"),require("photoeditorsdk")):e._unexposedPESDK=t(e.PhotoEditorSDK.UI.DesktopUI,e.PhotoEditorSDK)}("undefined"!=typeof self?self:this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=55)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},10:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(2),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this._queue=[],this._pendingPromises=0,this._maxConcurrency=t,this._maxQueueLength=n,this._minDelay=o,this._tick=this._tick.bind(this),this._lastPromiseDone=Date.now(),this._running=!0,this._animationFrameRequest=null,Object(i.b)(this._tick)}return e.prototype._tick=function(){if(this._running){Date.now()-this._lastPromiseDone>this._minDelay&&this._pendingPromises<this._maxConcurrency&&this._queue.length&&this._dequeue(),this._animationFrameRequest=Object(i.b)(this._tick)}},e.prototype.add=function(e){var t=this;return new Promise(function(n,r){if(t._queue.length>=t._maxQueueLength)return r(new Error("Max queue length reached"));t._queue.push({fn:e,resolve:n,reject:r})})},e.prototype._promisify=function(e){return void 0!==e&&"function"==typeof e.then?e:Promise.resolve(e)},e.prototype._dequeue=function(){var e=this,t=this._queue.shift(),n=Date.now();this._pendingPromises++;try{this._promisify(t.fn()).then(function(r){e._lastPromiseDone=n,e._pendingPromises--,t.resolve(r)}).catch(function(r){e._lastPromiseDone=n,e._pendingPromises--,t.reject(r)})}catch(e){this._lastPromiseDone=n,this._pendingPromises--,t.reject(e)}return!0},e.prototype.dispose=function(){this._running=!1,this._animationFrameRequest&&Object(i.a)(this._animationFrameRequest)},e}();t.a=o},2:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});for(var r="undefined"==typeof window?e:window,i=r.requestAnimationFrame,o=r.cancelAnimationFrame,s=0,a=["ms","moz","webkit","o"],l=0;l<a.length&&!i;++l)i=r[a[l]+"RequestAnimationFrame"],o=r[a[l]+"CancelAnimationFrame"]||r[a[l]+"CancelRequestAnimationFrame"];i&&(i=i.bind(r)),o&&(o=o.bind(r)),i||(i=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-s)),i=setTimeout(function(){e(n+r)},r);return s=n+r,i}),o||(o=function(e){clearTimeout(e)})}).call(t,n(4))},4:function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},55:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=(n.n(s),n(0)),l=n.n(a),c=n(56),u=void 0;s.Operations.FilterOperation&&(u=s.Operations.FilterOperation.Filters);var p=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return o(t,e),t.prototype._onOperationRemoved=function(e){e===this.sharedState.get("operation")&&this._onEnter()},t.prototype._onEnter=function(){var e=this.context.editor,t=e.operations.getOrCreate("filter");this.sharedState.set({operation:t})},t.prototype._onLeave=function(){var e=this.context.editor,t=this.sharedState.state.operation;t.getFilter().constructor===u.IdentityFilter&&e.operations.remove(t,!1)},t.isEnabled=function(e){return e.isToolEnabled("filter")&&e.isToolAllowed("filter")},t.getPreloadAssets=function(e){var t=[],n=e.getOptions(),r=s.Utils.defaults(n.editor.controlsOptions.filter,this.defaultOptions);return new a.FilterManager(e.getUI(),r).getFiltersForCategory("all").forEach(function(e){void 0!==e.lutImage&&t.push([e.lutImage,!1])}),t},t}(a.BaseControls);p.clickAtPosition=a.BaseControls.clickAtPosition,p.identifier="filter",p.controlsComponent=c.a,p.canvasControlsComponent=a.BaseControls.canvasControlsComponent,p.iconPath="editor/controls/filter/icon.png",p.activeIconPath="editor/controls/filter/icon-active.png",p.requiredOperations=["filter","transform"],p.defaultOptions={categories:[],replaceCategories:!1,availableFilters:null},t.default=p,l.a.Controls.FilterControls=p},56:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(1),l=n.n(a),c=n(0),u=(n.n(c),n(10)),p=n(2),d=n(57),f=n(58),h=void 0;a.Operations.FilterOperation&&(h=a.Operations.FilterOperation.Filters.IdentityFilter);var m=function(e){function t(){i(this,t);for(var n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];var p=o(this,e.call.apply(e,[this].concat(s)));p._bindAll("_onIntensityChanged","_onListScroll","_onOperationUpdated");var d=p.context,h=d.ui,m=d.editor,y=d.theme;p._loadedFilters=[],p._filterPreviewRenderer=new f.a(m),p._renderQueue=new u.a(1,1/0,y.listItemSlideInDelay),p._filterManager=new c.FilterManager(h,p.props.options),p._filterPreviewQueue=[],p._events=r({},c.Constants.EVENTS.OPERATION_UPDATED,p._onOperationUpdated);var v=p.getSharedState("operation");return p.state=a.Utils.extend(p.state,{intensity:100*v.getIntensity(),category:"all",filterPreviews:[]}),p}return s(t,e),t.prototype.fixStyles=function(){var t=this;return e.prototype.fixStyles.call(this).then(function(){t._onListScroll()})},t.prototype.componentDidMount=function(){var t=this;e.prototype.componentDidMount.call(this),this._filterPreviewRenderer.init(),this._renderPreviewsAnimationFrame=Object(p.b)(function(){t._renderPreviews()})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this._renderPreviewsAnimationFrame&&Object(p.a)(this._renderPreviewsAnimationFrame),this._renderQueue.dispose(),this._filterPreviewRenderer.dispose(),this._disposed=!0,window.clearInterval(this._interval)},t.prototype.shouldComponentUpdate=function(e,t){return this.state.intensity!==t.intensity},t.prototype._renderPreviews=function(){var e=this,t=this.context.editor,n=t.getSDK().getRenderer(),r=this._getVisibleFilters().filter(function(t){return-1===e._loadedFilters.indexOf(t)});n.isOfType(l.a.RendererType.WEBGL)?r.forEach(function(t){e._loadedFilters.push(t),e._renderQueue.add(function(){return e._filterManager.instantiateFilterWithIdentifier(t.identifier).then(function(n){if(!e._disposed)return e._filterPreviewRenderer.render(n).then(function(n){e.state.filterPreviews[t.identifier]=n,e.forceUpdate()})})})}):(this._loadedFilters=this._loadedFilters.concat(r),r.forEach(function(t){e._renderQueue.add(function(){return new Promise(function(n){e.state.filterPreviews[t.identifier]=e._getAssetPath("editor/controls/filter/filters/"+t.identifier+".png",!0),e.forceUpdate(),n()})})}))},t.prototype._getVisibleFilters=function(){for(var e=[h].concat(this._filterManager.getFiltersForCategory(this.state.category)),t=[],n=this._container.getBoundingClientRect(),r=0,i=e.length;r<i;r++){var o=e[r],s=this.refs["filter-"+o.identifier].container,a=s.getBoundingClientRect();if(!(a.top>n.bottom+n.height||a.bottom<n.top))t.push(o);else if(t.length)break}return t},t.prototype._onOperationUpdated=function(e){e===this.getSharedState("operation")&&this.forceUpdate()},t.prototype._onListScroll=function(e){this._renderPreviews()},t.prototype._onItemClick=function(e){var t=this,n=this.getSharedState("operation");n.getIdentifier()!==e&&this._filterManager.instantiateFilterWithIdentifier(e).then(function(r){n.set({filter:r,identifier:e,intensity:1}),t.context.editor.render(),t.forceUpdate(),t.setState({intensity:100})})},t.prototype._onIntensityChanged=function(e){var t=this.context.editor;this.getSharedState("operation").setIntensity(e/100),t.render(),this.setState({intensity:e})},t.prototype._renderListItems=function(){var e=this,t=this._filterManager.getFiltersForCategory(this.state.category),n=this.getSharedState("operation"),r=n.getIdentifier(),i=this.state.filterPreviews;return[h].concat(t).map(function(n,o){var s=n.identifier,a=!i[s]&&o===e._loadedFilters.length,l=s===r;return c.React.createElement(v,{key:s,"data-selected":l,"data-identifier":s,className:void 0},c.React.createElement(d.a,{ref:"filter-"+s,filter:n,identifier:s,lastChild:n===t[t.length-1],onClick:e._onItemClick.bind(e,s),selected:l,intensity:e.state.intensity,displaySlider:n!==h,onIntensityChanged:e._onIntensityChanged,visible:!!i[s],previewUrl:i[s]}),a&&c.React.createElement(_,null))})},t.prototype._getRootProps=function(){return{className:void 0,withBorderTop:!0}},t.prototype._renderContent=function(){var e=this;return c.React.createElement(c.ScrollableListComponent,{direction:"vertical",onScroll:this._onListScroll,innerRef:function(t){e._scrollbar=t}},c.React.createElement(y,null,this._renderListItems()))},t}(c.ControlsComponent);m.contextTypes=c.ControlsComponent.contextTypes,m.propTypes=c.ControlsComponent.propTypes,m.RootElement=c.ControlsComponent.RootElement,t.a=m;var y=c.adonis.ul("9uviv9","List"),v=c.adonis.li("13hv8io","ListItemContainer"),_=Object(c.adonis)(c.LoadingIndicatorComponent)("11ztmqh","LoadingIndicator")},57:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(0),a=(n.n(s),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=s.ControlsStyles.ControlItem,u=s.ControlsStyles.ControlItemActiveOverlay,p=s.ControlsStyles.ControlItemTitle,d=function(e){function t(){r(this,t);for(var n=arguments.length,o=Array(n),s=0;s<n;s++)o[s]=arguments[s];var a=i(this,e.call.apply(e,[this].concat(o)));return a.state={hovered:!1},a}return o(t,e),t.prototype.shouldComponentUpdate=function(e,t){return this.props.previewUrl!==e.previewUrl||this.props.selected!==e.selected||this.props.visible!==e.visible||this.state.hovered!==t.hovered||this.props.filter!==e.filter||!(this.props.intensity===e.intensity||!e.selected)},t.prototype.render=function(){var e=this,t=this.props,n=t.lastChild,r=t.onClick,i=t.onIntensityChanged,o=t.selected,l=t.intensity,c=t.displaySlider,u=t.visible,p=t.filter,d=null;this.props.previewUrl&&(d=s.React.createElement(v,{src:this.props.previewUrl}));var g=this.context.theme.transitionDuration,b={lastChild:n,onClick:r,visible:u};return s.React.createElement(f,a({},b,{animated:!0,innerRef:function(t){e._container=t},onMouseEnter:function(){return e.setState({hovered:!0})},onMouseLeave:function(){return e.setState({hovered:!1})}}),s.React.createElement(m,{selected:o},d,s.React.createElement(s.Transition,{active:o&&c,enterProp:"rendered",enterDuration:1e3*g,appearProp:"visible",appearDuration:1e3*g,leaveDuration:1e3*g},o&&c&&s.React.createElement(h,null,s.React.createElement(s.SliderComponent,{minValue:0,maxValue:100,valueUnit:"",middleDot:!1,value:l,onChange:i}))),s.React.createElement(y,{hovered:this.state.hovered},this._t("editor.controls.filter.filters."+p.identifier)||p.defaultName),s.React.createElement(s.Transition,{active:o,enterProp:"rendered",enterDuration:1e3*g,appearProp:"visible",appearDuration:1e3*g,leaveDuration:1e3*g},s.React.createElement(_,{selected:o}))))},l(t,[{key:"container",get:function(){return this._container}}]),t}(s.BaseComponent);d.contextTypes=s.BaseComponent.contextTypes,t.a=d;var f=Object(s.adonis)(c).div("120drhm",{lastChild:"229bd5"},"Item"),h=s.adonis.div("19g9ike",{visible:"zgbg08",rendered:"2jlos"},"Slider"),m=s.adonis.div("rf12k1","ItemContainer"),y=Object(s.adonis)(p).span("hpn4lp","ItemTitle"),v=s.adonis.img("3x5zfy","Preview"),_=Object(s.adonis)(u).div("120drhm","Overlay")},58:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(1),o=n.n(i),s=i.Math.Vector2,a=new s(180,80),l=function(){function e(t){r(this,e),this._editor=t,this._disposed=!1}return e.prototype.init=function(){this._initSDK()},e.prototype.render=function(e){var t=this;return this._filterOperation.setFilter(e),this._sdk.render().then(function(){return t._sdk.getCanvas().toDataURL("image/png")})},e.prototype._initSDK=function(){var e=this._editor.getOptions(),t=e.logLevel,n=e.debug,r=e.license,i=e.editor,s=i.smoothDownscaling,l=i.smoothUpscaling,c=i.preferredRenderer,u={logLevel:t,debug:n,pixelRatio:1,smoothDownscaling:s,smoothUpscaling:l,transparent:!0,license:r,image:this._editor.getSDK().getImage(),renderMode:"export",versionCheck:!1,displayWelcomeMessage:!1};this._sdk=new o.a(c,u),this._sdk.resizeTo(a),this._filterOperation=this._sdk.createOperation("filter"),this._transformOperation=this._sdk.createOperation("transform");var p=this._calculateTransformOptions(),d=p.start,f=p.end,h=p.textureScale;this._transformOperation.set({start:d,end:f,textureScale:h}),this._sdk.render()},e.prototype._calculateTransformOptions=function(){var e=this._transformOperation.getInputDimensions(),t=e.x/e.y,n=new s,r=new s,i=a.x/a.y;if(t<=i){var o=1/e.y*(e.x/i);n.set(0,(1-o)/2),r.set(1,1-n.y)}else{var l=1/e.x*(i*e.y);n.set((1-l)/2,0),r.set(1-n.x,1)}var c=r.clone().subtract(n),u=e.clone().multiply(c),p=a.x/u.x;return{dimensions:a,start:n,end:r,textureScale:p}},e.prototype.dispose=function(){this._sdk&&this._sdk.dispose()},e.prototype.isDisposed=function(){return this._disposed},e}();t.a=l}}).default});